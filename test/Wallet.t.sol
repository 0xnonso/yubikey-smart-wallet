// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

import {Test, console} from "forge-std/Test.sol";
import {Verifier} from "../contracts/verifier/Verifier.sol";
import {Verifier2} from "../contracts/verifier/Verifier2.sol";
import {Wallet} from "../contracts/Wallet.sol";
import {Wallet2} from "../contracts/Wallet2.sol";
import {WalletFactory} from "../contracts/WalletFactory.sol";
import {WalletFactory2} from "../contracts/WalletFactory2.sol";
// import {Strings} from "openzeppelin-contracts/contracts/utils/Strings.sol";
import {Utils} from "./Utils.sol";
import {
    Call,
    SignatureType,
    SignatureProofInputs,
    AttestationProofInputs
} from "../contracts/libraries/StructInputs.sol";

contract WalletTest is Test {
    Verifier internal verifier;
    Verifier2 internal verifier2;
    WalletFactory internal factory;
    WalletFactory2 internal factory2;

    function setUp() public {
        bytes32[] memory rootCertPubKeyModulusLimbs = new bytes32[](18);
        Utils.packPubKeyModulus(rootCertPubKeyModulusLimbs);
        verifier = new Verifier(rootCertPubKeyModulusLimbs);
        verifier2 = new Verifier2(rootCertPubKeyModulusLimbs);
        address entryPoint_v0_7 = 0x0000000071727De22E5E9d8BAf0edAc6f37da032;
        Wallet walletImplementation = new Wallet(entryPoint_v0_7, address(verifier));
        Wallet2 walletImplementation2 = new Wallet2(entryPoint_v0_7, address(verifier2));
        factory = new WalletFactory(address(walletImplementation), address(verifier));
        factory2 = new WalletFactory2(address(walletImplementation2), address(verifier2));
    }

    function test_CreateWallet() public {
        bytes memory proof = hex'26458c662c07955bc1e928ad9aaee36c6c263d62c7488b29e71c3a7cf821bc1318e8bac8cbd5b898d6d156f85fa2fb5bb2c2395686fdc0d5d4c292d3028b2b6001549a559c1731589dfdc2c37433595dfb4203df8f4fb1aafa6a505cf440497f21b5e11b87dfd104ab65a2d4c80270dbf8827707ac184120a671711c7f27d6e30deb8f0ece2314a7a2d03d233cb50f61cfda881bed9fc574caebef837e34de531c700c4811697372ffaf064db146740d0cb24ce278b930800eef93dc7d00055401710ef942e1481fba819acf3c93a7d18c1dba709871a60d5dcf0c320913a7a02e0bccf74c68de466d5fc2b53d84db502be2f9693e8f86506c951df0359cb4f016d978b7b8816ee022852166187dbd7a2e9740a2249f1731eef1386a9d127bca1df99d500189d94395441f33828c20e238dff3bd42e43c63eeddb9382a0252231f2036bb569c1308e97ffdab551806582531d924eabe05fd93b3a0af4afa7d302c0a61213cc7161d912606a5d55758144468122f11ed309ab17b577068c8d50d208b961ceaceea228dbed00b55954166aa0b884969a472c7086f8e9680c2d258133293be993ee0e6d631cc2e288b83baf8c94761841b154e8260bda07cb16f22156a04c7afa42163143a8968f0aca69f363802bfff9870f0cf6169e412fc93ac224cb0a701e0836f12a2db7eb44af35de693bdeacb45251b4a02766daefe1f6d2ce2f1a709d61fe55c088833fb7be00cdfa2ac7c2920ca87cf56de7107e53c1e1d00cdf36fe77a993084208199cbb45d722849039ed6866107901a3d72aa198f0fdf2b27ade81123540391a75801427089b1ae2d875b7063c705c8ab2312c2980d46e003c6db97247959e87a9465fe7001b8b105c316a564570060dde225f9f02ce04729b1c84e50f068cc3dca271bac7af55a9cf8a406c9c1ecf896c1bfa71704c78d5371e5ee81c442a1fe6d41cfc76e69f79a7aea5b8fd2a4a025951a02e81798f51e8c218fc8e82477fb69473f18ed9906f0096ecc75d8295cc3bbc226200b2445bea7faaafa0447e6e3eef7744249b6d6dfa7f6abaff11e5fa9f95c73651319b9859381bf0535fd4de988cf82aa24e5bdff158f7ff0ddd01151264955f7187b8b18b418d0132a1ef5170e3196adb946032ec01b73ab94ca0a33f20128c0271d257276675c15fd2713208751a3a686d04326334daedfe53af9290bac3fc711cf002d60335ed499a0f128b9d0a2ee3feda079fb02f9ffd8b7910d9611d6e413ecb6ff5e7d51bbaa9341842aac9ef594a84e70f81e47239853174a7e318dd1188853a1d0d0e04d5a178c2581bb125437755fbc17447d8fdb1cc7840771191407ee58ff04380e5170424076180f4a741ef2b496cca9ecf3b5f15bf0a1afdcdc06dc9d26268961291b84295ccea077bec235e186b2ef59b8c9cffad190e7b73e198288c1371e7c28095f5811a72d92af1bf51ebe658fdbf914cd9514aa74496a2f91354cf8e1fef0a18ec855d75d1a83e03665fd6215a99ebe3e453bdd0a5a33288d52324177a455623c8b1044c771f41a46b0aab32b7dd7b3782968abb527610bdfd9bc658c07f492eba76806640966abf253fc1be08f50b5fa472746d21dc61a101f4f1b1f8374203e5ba1355638e0b7c7167ee70b15f2e15999ae0c92f97a0dcb0af0e3e1c90c5774160e02b40ccbb519b2fab8ef818942f701efebd44a631b64d2f1483442ed28c88df066b5dbaa635ce7ef35d4bb95d8f1eced032d0a16096f7392efc9c563935e8c6c87b9225200f33882c36954c10025c4f70ae420030f2fdfcbd5142a584792e75f5917f7f4d1b2d9c4e593d6d210243dcdd9f0591b29b11cc4d2886ee91470c1552300f299eb78f993d06c9b50a4cfdfac366229f90743c974b078eda62ed52c21ae1eefdce6afbb006d22125a1d92d93992b54afd05946dc44edf81fbbbea112142e212ee84ed470cfe6d8950548f16d733d5b8a6249e2bac5970276ba782e1780b5672e0d02672f2ff4e832cc7c3a0421d4eae7e1c937575de4f619e60950142498506b6b5acbb7d70103b0703821e38097a22dd211367b4db335373ea1995d8d6dd4e978a887c85bff92a18206b834195f33ed71a7cea30ffd8af09b6f95a90174a5822072a1cfe9bf8de9023f95b74e594bf8721861c36980cce680cb57f877e444e4f6599970319166be15f10efc5c0c4160409829670b08118d923a4d90c5367be0165859359edac892fadfecc109c86c1300a367c86cccb3f398cb3814fe294cadb07423628c8bcc7dd4e2ea60bf469470625fc5d9ca7e287d1f66cd0648cf7fae77e5e2019feb609fe521d9e88b031269d20626c23125fb8ab98726025a9c65e3a502b2c95c4b7653e74c1e67e13fc228a1f86cf3fe40688bde02c39b1deab88b2801fdd6c61fa2e4c2401afa4688471180c276e196a3108bf97359dc2553041324bfcb610eeba15c1cc73d911bbeb5d89286c286e87b6208d7065969c0e6f7ad473431e0f54e2647ab026902035012f3c23901507e9726172d8b723519cb22bb33d956ff0087dd93fe5730f22d9ae8dc9109b77a9ac5b63d32608c371f4ceb06f8079519e0f4d2a92eff7f5ff53e5562f24ae34318a26d21d2cbf74e4624ef3837c86e2a738e67399a90c186b759160160bfb6e4718aca10fd3011c62d2cbdf2a48b7dd7c28bdb317c3ecfe99a702b775304e8175b0e56e460a8c90d00a1a8518324d6982748c0c4a31b6f0701c4bb39905cbcfa6609066820dcb40a77839cc84192644681ef0220d2510cc2a8af6842b09995b11c04277b193ab6f8bc44aed5d55fa24ecef074d95862b5205dc559a51290e59858aa4f0fd821b25840e649d2ef8d0619a7485a7ff0aef6931b2ce5dbc2740f148e6c446ad9149c768ecdf0ccae4d79390a85e0c0fd801ad4712ce4c230a2a90c2bf0706d91573652b1e27e8faef544b8debb99a1b797b47bc2582e2ef2fe8e49385b8562197fd9759fc8767adb2c9de12c8e8d61588dd1bfcf1bb8e49';
        AttestationProofInputs memory _inputsA;
        _inputsA.pubKeyHash = 0xd45c67436abf1348c998f4065086971efcf5dd08c52cd0ae95f02f42afb77534;
        _inputsA.proof = proof;
        bytes32[] memory _signers;
        uint64[] memory _signerExpiries;
        factory.createWallet(SignatureType.RSA2048, _inputsA, _signers, _signerExpiries, 0);
    }

    function test_SendEth() public {
        bytes memory proofA = hex'2dd307e15e599d5f9281c0fe4c5daa4cc2bdfee75a788c005c530eac4862a75c1185b5248872e7342567e419eba787cc7a528395a75b8182d16e1116813a2d87254326735bd04b937a85deb3de2c3188c7b5f058bd43dd19fdfbf55e558d14821ce969e5d57eac1a6e0912cddad51a5769f88d2ec6e7b0d2e65c3354347c7cf11db30a3705ff7941d3c6d6288d1ba2c9cb8276c8cfb842c8f510615b45ef844c0755b876a135f1da67428c90493c13fc5d8e2dc30748d52e1c102792739b125a085ec50d53cafb637713b117b679fd2507d5d9671247a95826387bcf454fee6f2f75e12ce0eded2d1aaa46441cc1c4bd9bb3a6dbb9e257bbb8160da3f478683915b038d95f2d1609b6cc3d6019dab4ffde9f84f677598c8e4ad2602a402ac4b5301defbf932f44d1cc1fe605649798193a0194bd23539fc79f4d806895efcd410587b45e4531156e3d9749b4839c29bebc19e5f3cfb56ae8d6d6304980f3cb200aafc98531f386f0c8a825893f92a8f8a223de118949718480db479fa8d5ba82227ed5fa3b9ec0bb95903e7a8be8a313f61209208e0b8c4369336148842fee982713b4eae8845457bb02ace62f1933ce3fba11c2e573c5b5ae6d6e7bfba27eb1027312dd8d977979c342f88e2212e0784fd8c207be0bac13b3c57191e1c00df71f27ccbe1fa0eb3925ae87c27e965f3dcebad14d4fb5ac4348dad7872151bb872791c496602d35d10f384d2f2acd7f6c0c98677c20c02f48c23c53fcc9f20652196a6f3f77b186688c64ad9d738b13a9794af8b5bb8f893abd4cd9f493a324761265ff693368760f3fd8531344d6a58c3b05097623b7627b79d9fb399db1dd560b60382e3ac2398d2487f9eb3db48563f0ecf398f27f3f2939cb37444f8cb51f1356205004dede73df5412d4a2214a8a375a6d2afc7726762261af78e1da040c2ca7d43e6086789f30d4c54651b3e92aa105133e801774fd567c0866775c202827c6af6a6d7cfa7954a30b3dd8e89740035f5d2153d5122802c4e5cf9442dc700fbf5178e6760b3c656462aa3af36df7a4de3cfb390404a37133596b747f80c622d0438a6ecf3f57f7605c44f34e4f65f29bda1e980d551e3f571c727b0d31642380b66d2aa22cc122325a5d1412e88b65b97076e6aa19efa3691d8bd03cad2f171c54e29de919d1bbb4e076e154a690bd307b17bbb9e665fa51e72a8e6d129b259bb43b64460be6630e5b7c29bdc26ad88f4259256b0740605d49cd7738e11d1e3fba562da6e90c169669efef22953d8eadd30b775ea9cea24114b06c8001841bceea3a07f4f6773aa73d63d7628c8d1b516d5cea4dc43b73d037144b9b109e282531a06f30abaa3ab2904734422abe16efa0da2d02247a894f31bd2a7627a42b1ea22da7b5bd76a9c67eb4894091874077ae9358a8b074f48dc0cec2a5056e074aefc0fd567a3b231acb852d7f3a099456b47222ca8d35b2a5671afbd0b83f00c38db4d36de691d25a6585990f0bcd40568a21bd7acf1dcf0461038fdd515109d666911ba647a38866648ae1970c149b8e78bf44222554a6751496c12ee5a92b3c637e00d6c6d8cdb1e54da6662a4333610cea89daa5d224ac7b9acba5aa7629d174ef11e1cd59056e06b3435da247de365bd874c6ece11ee88f30de790b812e70ff548d75e56503679b7048e43e909064be728063ecbaf40e1ff9d9dcb597220755a7ba3dc56d413bb1f5a18574b0a301a1ea4ec20285819e2acdfa03b89f1e185493bcc8a9b7966943743a383855bb85eb852ffddcc205cfee62d0836d5a2d6de73bb60d2141f8c5b2fc011b9a255bfba2956fe3da50d803ea7326622d5f21e929d9ee2b9b906f6ae01101a24d458bf0f95546a1334caae762ceb0c1b3ee0b110a4de6a289924885d642a18f3079b2692290bb0dc390e262763eb38440fa02f0a59a0e0b0c936dcca25f4f6ef31168596ea68d5963c68a8ef488a178d68116c7c5692efb6107687e7b8f074c123598aff8762188157a83378cb6ee8de2940370068df5b040f790ca5e13284e0cf8961f716aa0a9bc2233acbb0b6301e00708af1d5c76cc33f56443d95161693a7f2c496814515dc988ea332aa9165be47226ce94aa3810d65518ddd1e54d34673621932db721c72c40d0c05448f32bb175158e061a3759914d0710e6dac852e300b4993c02150f8fdd382329f168ad8b692d0488af9ffa9a048c227611c672d29570b25638a78e750f0cde0e9403892c5a25f159fe4f58a612f40c73c9dbc05c1810bbdf8474f0476af244d3a8f09323753034eb525296edc6a0bb7aa2de654198a00c55fbca5b33ec2d9309d77319455815c9eadcb38efcb16ea22796a77461186067f4650a1f912bd693f3b05cc44e7429079d71236046cfaf6cb06c535b57c6c1bf4a0354eaa6b78742e685f62a0040249124af01c9abf1139d06d5c3e6279cbb23707ee7e94e6c36338d8609e5244a2916c55dc29b2b169a4412539fdc47f9911d39dc421258af1f44eafe21c551d02a45e101c571dd4d27e4ca8648e4a7b52d2a9ce30f256584d9ba408b0ebe2e3410018b9abd12cf741a8c0a44ad3d88a7473e912c1b34be0312b08bc202eb2678023c3c1bbef977bda417a6e9d722e2914a22aa359f243b0549ecd72aac55c1711aa184ff465c43fd9b807b12f2a429e257265e2aa9041480380605d7dc9db0b60c3c6b697001f6764764d3a48162c9b04e7a986770d779f0d8baaf783a5776962badfcfa0621db60a7f23e1022419b38343d67c5328ae9d825721eb1afb43058063856f4bf1a9b6941fabb9b272f4c0347c1560abeb7259a7348c8a1eac4ea9e2690b920bc9b7824e1ceb8f5f420c9458dd74a02ac3a36952f83d06596ded13c1fb6b558fc133e6be4aafa7b6790d0223842230e87a68951b90ad804e3050cee18a036985c145d68eaa1fd51574eadf0105490ec2307d3812ed94ff8de0822fa11d03cef2c295680321b16926671a94229d40a355d556a4f1204fb7c47767a62';
        AttestationProofInputs memory _inputsA;
        _inputsA.pubKeyHash = 0xd45c67436abf1348c998f4065086971efcf5dd08c52cd0ae95f02f42afb77534;
        _inputsA.proof = proofA;
        bytes32[] memory _signers;
        uint64[] memory _signerExpiries;
        Wallet _wallet = factory.createWallet(SignatureType.RSA2048, _inputsA, _signers, _signerExpiries, 0);

        // SignatureProofInputs memory _inputsB;
        // _inputsB.pubKeyHash = 0xd45c67436abf1348c998f4065086971efcf5dd08c52cd0ae95f02f42afb77534;
        // _inputsB.messageHash = 0x653842f472a6851c2022725644f74899d39ad2a808c652e68d1593a1f1725459;
        // _inputsB.proof = proofB;
        // verifier.verifyRSA2048Signature(_inputsB);

        // factory.createWallet(SignatureType.RSA2048, _inputs);
        // verifier.verifyRSA2048Attestation(_inputs);
        address bob = address(0xb0b);
        Call[] memory _calls = new Call[](1);
        _calls[0].data = "";
        _calls[0].target = bob;
        _calls[0].value = 0.2 ether;
        bytes memory data = abi.encode(_calls);
        
        bytes memory signature = hex'09f2a93c3db9dc34b4da5edfaa7e1a2b6624f0b6248020b60369fa2dfb21308b10715110f0b45e9f539d8f3736a5133f04823bce8e46e255d100014f5c4a197f2ca23c85389cd67235ba9ad06e5f0df6a94def3285580b4af08e6936b0a7662b0f5349b5964d5c3dd9692763a8822fd5834649cdd724511874dce11ab94681750141f32bc4a07dcbcb3592649e6f0b9637205371d864eb31b74a23756a8b057b0b2425089e00a84df9ca1765fa0415bf755239a50a80bc2156078b6d14733c631fd9b41d38c3ccef0b5dee1d505d684c814d3882b1c2d2b6c6d259495e3389a211c137378cc40b8f8b7dedf86df0d7b51d931c6b333cbe8f47d5e36ccde8122b19b0935373f8f8e473c1933c4070af3235519608d6fc34a1dcc95f91d93dc23821a3591d27dbce82e101472f9d1f37164ad8db41a0cbcd7a2f931721a36c9ec50afe89e5a28597c395fd1ea0bc4bb9bbda906c59b30c48339d4ea0bd4047df5a153703af6c76ee151216d75d7f88e5e0e9f80ec1b23b0e79bfb86bcc12f520621781ca33421e08beed2a447ca280dd01497ccc51b79c176107ea3650f51fd3c513b7188c8a082cd22c5d8868cd4a564f44c5f9d9f2bed7990f9836d5115cb492247918a7406232a472cd8ffb8a7277b881e4c9a3f1076d24cb511183d8bb94b53001c8832496457a7d254586cacf1bae6f14b9a1efb6aca8a2aa5ac44fe0af0c2ec0e8cdcc6df952964940f296f0fdca71a0cf7c8be5fb6c37d4ca3288f885a1149197bd0b59efa272ab4886336c8e5874187e1a35ce93f5e91c24ab8cd190df136e332e0d87f9621d021a3dc9f964ca73f13d5ccf061f4763e4ee8ce2414e48214748ef532a104a195c85a0ca7074561be45142deed7c7131d4b65385dc344320da64a3ba23c0b2d754650a745553d2a6d065d57374df288d297b167ca7c2cf24044aa5c4239159be321786c608612ec619c9038844d6ed91412dd4fd77c0cb2a511f0cc7a640ed266e40d3d8c73cbc7b267613e704ec8cf446bb299c9e81e920e823446f93f0a5225520887e6cc1707efe75235e04a5303097fb19353f65270fcb8606b418a68210cb489fc454b013312762fb50a5062772af8348fb46a5c900d9903f84b151e58b05f51e6109e4788920cc5c74676533aec835aed97bbd86009e2ffff8ef965436c04b75b836cd63b79151b73c6f83766ddfdb3b415734dc21d139a0ef8c1335da4f623b1679135a40d7eef4147ce94f2777c244db75342d1b8d8aa5cef73757ee6f1dcfd0fc853ad75f58a3ccb0db64f8f502588ad5904605564a9e19ce2fd81b0575ad4bb848a10b34e420f4d949864f37d266df96c6b72acfe9447bdbd48baf2b829cc6529d25ed2c8273864e0d319da36fdabc0d366a28039c5ccb39f9357bd6237227bf983024a7577058815ee0f7bf0ea2c6ab7b2f2126ff18801b63de9e238ca0b69c120c3f02abb2ed4bb1dae9255c7662f2d6c52bcaa0048f80da15946459c157a30537af0d8c411bbb484890d3e1f1f611cb8c29a33dc7bb16ffd6ea6c50f8c8b3ee1005fb167f365e0626c86f0fc169eb58620650bd4894899a362556a2add942a4077b33ac7e5e34658f56b5b282d44b41240b32fe0c69cfd97255fa38db98f556844efecccdedb1a17631de63846b3e9f3b000dcac88a5691422b49e58f854ab4b86ca87d7eba2bc012864d96acdd0a2e810ad04814cbc08c19e74780563f1a6aa8ba8ddb807820ee6dc0c14fc4804433ac142751ae787d771c2ed7df9c93d4e70570aa000565fad2584c658728adfebd46025d86b8bf581c21b4a34700e47116de1a6911c859d4fc20353799b51ebd7ef81f780fcb6e80a67cbb18561736c605b167699047037379c9940ca15c3bb2396f098fdc063afc2520aff31854ab0aa61cdcb96caeb9911201e983161c3ad947580a38265d766b78740d1b45ac7fdbd5121a472f024444bbdf1354020d9bc04b791fdc9c26b2b4738dece9f72ad3bf08d01588b0bcfe728d264303381013ce49ee08fd35f5b62884ec8f4fbccc74b88876fbe8a9a51d4370ec3fa927f70875c513087a153f0559ec170b4c66a0da9cdbbc3ec08b1abd6bfd77e4203c374cff776918c589c4e58416f515cd0580cbd56a79f39c164643051f8c459f44190e444ed120ece3efe8e3f78bb62e35849ea2bfd2d6de23545abd5504c0a601b9077289010d890b082ab015841e99094479073d0c9aba372699cf84c484717e03183968171b2b742baee62334cdd294b38ba73f65208e201642909d4c60f3069318802c512c559c7753605ac22d075f58894b356e7c8a7146f30bfc49ea7fccc6d930c80417d10f1d7e0d0065dddaa9f60378bcc365c9faec5f6d28392394627fcb4807fd0512075846342e2fe3c0c96621b3db6a5f8031a90341d779d4c404b395c24bd80bed91dd8b0d54021f10092857fcd271f75f0cc310f3a82b6de195d39ee3474a10dff75aa254596e7a158b9bdb39fbf08fae2d3c8b522b9248e0df8dbc6263211b9c8192593eebc154619be00216f12aac6fd7e90bfe589bc5bace39d22aae2028c620ecf56ebd0b0ae97ceb0a8afe6a9af73741dedbb97abb929cc53a93d2be1dab85c038d7d69872b589bdcb95cf57b9b2e0d8a560f671a157515ddbaa71510ea98a46eec9645fc6f86a756c50a74d7a9e25a89c0a0b1e47e1f999710050571933ed2376e25cd364e525207ec8a1545846ee870e7f65fadb2155724ca866511523ad320974b46f2102e3b465c3f6c26c765eecdf2cab3d03b7ebac7b0bd7a82a4f1b56593c746d141254d7d54773dadd97d8b6b33a32fcdc215766ea7d0aed216970edf115f340adc69786c6b2b06c9035130926a15a085d78c9d0af5c69f02c9a5628cc8748d5ef1e80aca1ad03a89d37b3c8f3941589e7a7d1e58de126691986321aea4894f95d0b72aa069c038c8837a60cefd056fce5f7c655afc30c081a11eb5ed7a4bb7ef3342c34b8549c68e571d735d7ed7b192dea2e5c41bfa60e';
        vm.deal(address(_wallet), 1 ether);
        _wallet.execute(data, signature);
    }

    function test_SendEth2() public {
        AttestationProofInputs memory _inputsA;
        _inputsA.pubKeyHash = 0xd45c67436abf1348c998f4065086971efcf5dd08c52cd0ae95f02f42afb77534;
        _inputsA.proof = hex'023bb9453e1aa9caaf7f8f4f8071e8809c572c48236e1a075bb392eee9ce02bf043601b2476b1ad2c8829d029ac535f25f5bd7401d9ff67328903229cdcac200229a542f12efa9b9ebad6a4318d8fd58683e3913499ff7ec3a4e3f1736cdb36b053d903136dbd3296e7d31cd4272c3e090cd070d2d8a4bbb5d8c8dc764e0f95926e3c86ff917404c8b302cef766dcaae692f71bf69825b98d298d4df6932e8fd21c7b0a3dba7ce89aa11b55b799e93dba0ed31b52f187cd583025caf3d978315019081ed5f5d17e400454277b5f3f2705f193bcd60adedbb9091771c77a80ce7278a8333140c32324cc9de75cb122b05fc31f135623574715df27c86956404a02dbe3891a93c70f0ee612f5b915d2afb9ac3edb7e677f0d3244ef1840a7199a60c842f11442d39cd0c997d2a45020c96e81421ee7918cb629302bae1586b48a720b3bf65017634537b39e2874c1ca888c577429340dcfeed43870eeb950392490d2a699e5240dfe9cc58d0c9d893de86430e3a160072bad34842452c0f163d01019bad2c161fe8f8b5cd18fe308810a57233cb2efc002404a6e12950441adfe62233e1ba2ef90eb2607471241f080a0e962e27a92f8ae692e07a2cc9a1aa2c1e2ad269cf04586c54fc28e9110118ce4e1ce552cdd25f56ac6643094bc3e81c2a148581e656d65eb2730c41983e4cc70bb3d5244c99688dd5a6948c9b6f48032710ce82074e29830e4c142cb3c13f993628d662ea45236e8b160ff8411a914141048c19e9eb50b76b1cf40706bb2e36575d7a7b42711a55f63d495d07da2666281c2c4eb58a8c45f5fcb295cac432d78aef9047aeb05638e37c75a1c92ce12a0e27c78bc7db3e18391b3d48aaae4f276ef1565ad74da0ef64da0a2c72e1dd0fd223a3dfbcd035a17058d7a9093254a2149245e38a403dfde3c9830850f4c263130827e4ece3d129f063f875c62fe461eba6491a7690480ed4917e489e9111506b22889be1771e4fd7c85b4bd774d87c864b7be0db56429050f4faa923c0f50bed27a8803be437ae9411c2d23a1c89b0147a92ccb008657d790af23ccaf245102517147cfb179604da1835b0b77bd2fe1789cb4f39fa8a1befc996c026fdda04731405018011e94a88dbad5921402c78a161fb9cfa8974e91185d836eee2ac23b30ea490eabb98bfd85776274baa51f9db063f345e1cbba73ae4c12de2e053002e24aa6e700408b8746ceb5ae7779c2cd22632ebb42c9be3bca7cebb2972702b01078ab5d1807b69bb9262fe1221437325157b54c3688ff4b1e65e3fe29fcf39561fb26f98911e1034a2c7a66a097f00b632cadfc95f58dcbef924dc9b1357ccbb2cdc1f574182186c1d360ff8309970213595717a2c8573e9c166f83fec2fb358052d84d85dae51f3e64e941e3b8f423939f1d9f8023ff2a507894bffc545bea00ef3b744cf611b46001aaee311fbf94b49641c18b7289615e5e9dad1eee3ab4c2f632f97771a0bf456dc005a6ee15988645b5c5f888f11aa3df88c6219cabc820253f610cf26942fbdaca47c04c00354c55ec4526945bbad8e6d50c45f87b5cd27818878c853df659ec1c472030f1a0a6c8ec1c92588eea9f900b9bdbe2c1b0b09bb5a901fcc134e23ec2729255fe7ec4954048fed134efb612a8ff1e5a29f4817763b5bc26b719f856a5441534733f05cec66c9c35ac187fe073fbf4a439961305bedb3961e85e38df01e13d108c0a69ef7d6ab5cce422c9ef804123b5553bb2ba88dfbf526f7ca3c167d14eb3acf03113d865fece249bf83f1f211a2b69adb21c24cd2ceb7c999916817fe8a3eaa22b861645550a802eaba5461b557c92c3f1eb4d193ab34ad021379268d87d5e2e78a1d986c83b3e0592d8275569a9604db0175cf9ded50652d9d65be83ea97c379f42f03fb52af7c81ca49756bfaa98e540b8a3adc81dc651ac46c4431b90d9918024e6cc0a0560d55558d42ef59504c071461eb96374a3e1e2061d97de1effdfccc5443eea9f1ff33f1bae56e02e4133f10a7b7bc0a0b15bc8ac15d5c2a25185ebd5cfa5fc02150d758d59f78a26b613c1c28663ecc012c5eb254fd7f2c478c5f3b10d3bf0b61e512cf95f8a854557510158c3377b54866153bf4cd42a12d0d9640959681d2400f7e92bc7dc154cfd51e18ebe86f85787dd92529cd3b52c7029de2d3c4c2f35475bcfbf9dcfcbe2cdd302ccdff2e9154329a08e6120e0b584b7d83bb3cffba364632806c9c7146560ef62a86cee998bea264aebef9c140f1482cefd341c91a8708c7c7b01cc2d2d0f1412e9773e69435c30518c3004e48e2a8890df170dcbf56e6e41496846bc7d0ce032b562a68f015a3a7e509a40ee907f5231f375339b619558cf8f4a1cc51f800fb06ccf6c283855a8d584fd72bbefc1f54c257154e8009d83cafe0725fd8fe31dc2d78b1d3f9ec4a29d862542a3637740b64a59fb107b3d4c02070028331deb1de05f4c830de13cd417f83881b7dfe533087471495628ac9f62eccb7c83d2623491f2439b48919c65a62682623e06da31b6ad93bc0d72daaadc48e88a57286f4f31e9f3fa7bea94d97f71e4be9a6d64e1eb112c52f96bf2e3b5d4a308602dfe8d92f5a9d55936e80b8c51493bbc3376df9f6913b8d4a0b150d5e76fc4cf1979d5f15046dec2b88a7f8f869cf19179be40b2d7cb13ca5a606759bf413ccabd660ad01002142a21592ed773591cac7607a38d3b8dd0340062c15fb3f1632ca31b8e8102ff7a86e5e80f37385310a76dbe65e6b45e4042839a401aa3f0a4818e7e3b508b5b476324335f45f45265416a36455e0b86a28f53c58553f609d2921322e8505f384974070cef03c7361af2f7ecb7089bcf4f0171d42c3bc53d64bdebae7462079218854a43ba1b79bfae8270e517245e839d339d8dcabf4cdc22fd6317dff1cdcbd2799cd3aa62a59b496cafd19c7d8cfd4bd6742112c505269b2426d4b95152acb20fa761b3d443142eb298a2233e67335261293990b1eec7942965d4da2';
        bytes[] memory _signers;
        uint64[] memory _signerExpiries;
        bytes memory ykPubkey = hex'b5832f15c8a80b09a56e58dc781d935d0c8720ab5222f0f91e32fd9bee009243dd43752086724e25848dc93bf8f5d7642bbb9a3c7c262029c0e476e83a7431b241781f36345c6552dd44ebf21b2cd9f2005d1509d2f176d5ec9ee90f494769e6289f7e0595302fbb2694c5dd415e1e2f0298ca8b31fc7193acc0c83e814f38284b1524e3babd3bbc2b5b23849d1be4e7ad0c1690eb8f1b9bd29aca2e853a6a42ac9d4e2b6128d960be82c0b7ad2caf85521d27b1f7df3dcd105875997cfdcc21a6d51dedfb439970616a040af9213b1f505084368c8a3d1427be6d2c254fcef9c7cde3802bfd31cf1f336558c1b270e87d3a5f480d2cc6a14d880cc20c9c8e8f';

        Wallet2 _wallet2 = factory2.createWallet(ykPubkey, _inputsA, _signers, _signerExpiries, 0);

        address bob = address(0xb0b);
        Call[] memory _calls = new Call[](1);
        _calls[0].data = "";
        _calls[0].target = bob;
        _calls[0].value = 0.2 ether;
        bytes memory data = abi.encode(_calls);

        vm.deal(address(_wallet2), 1 ether);
        // assert(verifier2.verifyRSA2048Signature(dataHash, proof, ykPubkey));
        bytes memory signature = hex'b51f8e11a28da930c9a986a189c15adf8cb50a6ec180b9a22f72c1575509e76d7859272f626ae1469552239324a9ae9bfe22b7e6cb3fe535955e6be93ffb0d3f633fd2e424765aaceaeb0306ca07ed049d3044a0bb448cd1664051863211bf5c210c45ad4db6d33895b054138320d2ddb4fea1c68b5451337d45b2099cc1a2214ce1630b92bd04b6dd68eb65d19b10c2add35c4d55c9b738a8d01e7a29709dcb59e1904c08e185c8783eb2d753544ed9bfd474b50dd7d4974df6b04e727c1092ff5f82ca64df6313a3aaf12266a0412f684c2b8d4f7f04d22ea78cdc26c01207b5be5e0e2f21db9e4af749e569413b7e43ad5f207c6c2a31b1242dfc554ee146';
        _wallet2.execute(data, signature);

        AttestationProofInputs memory _inputsB;
        _inputsB.pubKeyHash = 0xa773500dcddcd8aa9d09dbf98eaff6c29ea53b360449f7db7a808ead7ffce84a;
        _inputsB.proof = hex'1771b7f013866fc8023c781bbd11e02dcc239050128ed9ae4e2060c82ec08c4729e4d2d5af7ef2a69236bd165d0d21ed82d0ddc5f3b851d0efee0a802b812afd144bf903951cfb984a8cb16ce89b06632d03672a6ed210cf35e6b9984ac1c81e22e9c73856f1eb0d96a60deef15f0eb343043945100cb00e1a09a1db927cf2fb15c5efef9ccfd6c4361a836225b0df591cf5405aead54f60d30f65d3d12cd52e0d9f45cde3ae79fee4ec67015ec4d92ce75b016af975da8d805464291623342522e1d531e19c68c43ff30789c325fd9659757d9fff5e0d3e5ba49eb927771e1812ef5e23f2213ac9d94db516417f7b56a17fad4dad8f7f2dfc2db101e9bd31ea2f21940d54a8324118d1317ad6173098a053b64c92b3ae6197dd88b4337eb16b1ecee9d0c447d8a58bfe6f269e582f2774f44756dc213543868159353bfa8d9c1f4c5e4e9527b185c3c853cd6ed02c5853eaddf034b994989c41a9ad27848b850b2d52d642de75b65365c3a431e27b90d7213ffed81f13235a8ef3b78ad5695a0d793589839ee7c8a049b8e0f0f30e842e02cf28d2c530c5bdf858651690b18d29f59aeef6de060aed0c2bc559646157194e001474d0342b0797dc816f00c7b214ba3395e6ca4d561bb1d042a9268afe0451bfb7ad503485cf5e807ef3d39c38016367e3f260412b71cc6bdd6ae5e88706c4bd3d020b4ddecdc87e7f754f323c1493bcec7867b7c23b5251bb5ce2a3a7e796f4aea7aeb150a69926fb090af75c132abf53ea74c71cd4352c58832daa40dcbd4fc9dfb47372e7dee06058fc5b7701ede8856423f54f54d95594fcfbf7ef36358d570ac6e67b0672898d821bd5c90beb7028e85e4069332e322f845112e7d505d860228416573c71d8ebc24f18b102abd3d3f30f6ea82cb418b7b81286892b3c7f83147463543966539a25df12881904ac3a47df0ae98eaca10aca0e2ea81cf17f7b831360bfcf5c61ed742ef6e3005520ba8d89f1f31cae98a4ce0c0a0e695fabf5777b0fc2cc7241c6c37b2dad2113512f4f41af2a98da4ac64a6922c21aabbe5a192f4656add67fc6d630be6c0b4e73db026ba6f286280ce359c3d49eee192707ea206ce5a33e8dcc4369bb15134333445779f4eff2dc47e5caf87ea430617b9882a8de97dc429a81ea16e2422ba3f105126900ceb1b3d98c1a72f47165138da57eb709d88dd92e3ad5f4432b0e711145491c58d18a6f04c720d78f91fbea3ff7d5e20153a0d67a9f167c14721d157d336d2e6656b6cb57ba1479754e4c3da992e159f32858b609421fda866c159763435037628d229c970a472975f12ff04fa8c21ca8695f3f1fee058607d6234a46dfbf068a9d9a6ee098751312a1edb9a8fbada035b3a36b44659d1652b916140fa485532e15d146787174da991f0626fcb64b90e42a576b879f302203602862719cd818ae199e6254a870530390b8b6a2bfe9d0cea773ba8a3618dba31c005ee71acc2e2566a74b01168be46a62c0476b002c5ddfff31373e71646fff2814f4119ffe7098d6ba622850c1a21091645414c3de962b34bd798833371ce4a61d8be0438c007171c830d2fb99a7424eb8f8c12977d89d0b4ce672fc2352daa42d1f765176afdbbcb0f451237b191b0fc0f9aa430cdfc09bda5d53a62de74547185c8a1ae327bd3a43ab7941b4ab2ba90f6ae138e9299966cf225f732096e1451bd09f201ac97d4fe2ec80a575cd9f59406e47debfffd8cc0bb37294fbfc40901af0a250cab918159f7b38ce7c3ba9446726909dc8e66d048423d3aa23badd922097b70c82e76433f8ef00a529716b27f0dabf3e06a2235a62f3bfc4c1198f75135bcaf252c8a87388b57d775c00a98e8f6a037e29c27bb5ab19633e849e786815c544e785deadecab2192efbdf84de28c58fce8a58f876ea5669c26e0e1b1070e973e6e78e46d5350cf2d6f0f2fe2741309afd0bbff5a3b5dc9864f4c3f300a0abb526573ba7c3fbb089989fb713336b6fb53f78b88aa38cc5c157c23328e3b2fbcc5e2fdcea9d9bb15e7da81e66906a99a286de853a08685b2b775e9dc58bf0abb82395147dca6d940632971fc274f01ddcc01eff45c7a3f2912d7afccafe22ca45cefef863092081c756713755044c3f5ac837316f3ac0a3242a7ae61449c1c88777761df890619b2275856b95e208023efe7e43809a79d422502077777ce027fb323508911cef8adaa86bbb1725ca1c709717c23de23d565e8bfc88884de148c966130c0b3b79b15ebf7b40670112b2131625f5c97c738c4e460d5dd32ca2e5ee61818cb76da480ffd77d5eb697119d4af5a6adb8d158b134939ebdec7ab2e79ced02aa31ceb0e5c9aa241b95fe0c611b012efb952e2046639fa3898440c23a858c972110255d8a0b0e05e6ff6040936efbfc52efa81f54a99057aecd71701cefbdb2a422bb17898040bacf799b596a0856f3c926daa4570152efe9b11170e300574b8b36e3a3ac51db4d9192fd40b370c1e1583cda46c54583cd1749f1c0b5748b80fc220323a2f4d1f9a12fefe1c917696a204114fdc5e29b5dff105d60cfbed08316e81931c5c0758abed9636b90dc0dd03a6db38bed124d22bdc0e9a2f45003549be3630c9a28474d366d18feece49d2249c5a4d1b3203e6d8dec22b21d99522425929e81d57647e788e601e60b46bb8099b09bd815adff523e51e8c2da1b4af2622165138a460da77d4363e271c7b4b53b7045d36f37c39da6886240ce53c35d7c2ad1e539242106879d4101ef5e6460676cf7985f91585f3e5a05b24f473c8a68ebe9651c65dc8473065c8db3b8aade49ba1b1acbbdd4a7ebfb43209c5959265f27f1f10cd7f4c4c90f8d3e3268b94e00a8938f44c2ea04ca982c51d1f5c61e9e67c217d17a88ca2e32cdf07375ee774dc0b417620937b64249aae2431a08d847a0483b2fc04890031e401215a445a60e3a821a54fc7b389b784f41c495336bab72e76f24bd84b642a8eaeb81e3bc1df8ee085a619f6da189ac91f';
        bytes memory ykPubkey2 = hex'49f5c8596ffff83b32c08d48db7ee38c7e505e503eaca4f08ee23bccb0193cc77f031c75fc908946ab3e64ed056affdf776526dd7312d375dbb028be048d225a';
        Wallet2 _wallet3 = factory2.createWallet(ykPubkey2, _inputsB, _signers, _signerExpiries, 0);

        vm.deal(address(_wallet3), 1 ether);
        
        bytes memory signature2 = hex'1412FB749AAE72F9FFBECED2A76CD00A2FEC7D20055A72918F7A7BD707273EC5428E716B74DCE6E3853A3244DCCA22BB4E2BEF1A17E32F0FE5919947E532434E';
        _wallet3.execute(data, signature2);
    }
}